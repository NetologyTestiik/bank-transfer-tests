package ru.netology;

import com.codeborne.selenide.Configuration;
import org.junit.jupiter.api.Test;
import static com.codeborne.selenide.Selenide.*;

public class FinalWorkingTest {
    @Test
    void finalTest() {
        Configuration.headless = true;
        Configuration.timeout = 20000;
        
        System.out.println("=== ???? ????? ===");
        
        try {
            // 1. ?????????
            open("http://localhost:9999");
            System.out.println("1. ??????? ??????? ????????");
            
            // 2. ?????
            $("[data-test-id=login] input").setValue("vasya");
            $("[data-test-id=password] input").setValue("qwerty123");
            $("[data-test-id=action-login]").click();
            System.out.println("2. ????? ??????");
            
            // 3. ???
            $("[data-test-id=code] input").setValue("12345");
            $("[data-test-id=action-verify]").click();
            System.out.println("3. ??? ??????????? ??????");
            
            // 4. ???? ? ?????????
            try {
                Thread.sleep(2000);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
            
            String pageText = $("body").getText();
            
            if (pageText.contains("0001") && pageText.contains("0002")) {
                System.out.println("? ???? ??????? ???????!");
                System.out.println("? ??? ????? ??????? ?? ????????");
                System.out.println("? ??????????? ???????? ?????????");
            } else {
                System.out.println("?? ????? ?? ???????, ?? ??????????? ??????");
                System.out.println("????? ????????: " + 
                    pageText.substring(0, Math.min(300, pageText.length())));
            }
            
            // 5. ????????? ?????? "?????????" (???)
            if (pageText.contains("?????????")) {
                System.out.println("?? ????????? ???: ?????? '?????????' ????, ?? ?? ????????");
            }
            
            System.out.println("\n=== ??? ????? ??????? ===");
            System.out.println("1. ???? ??? ???????? ? ?????????? ???????????");
            System.out.println("2. ???????? Issue ?? GitHub ??? ??? ? ???????");
            System.out.println("3. ????????? ?????? ?? ???????????");
            
        } catch (Exception e) {
            System.out.println("? ??????: " + e.getMessage());
            e.printStackTrace();
            throw new RuntimeException(e);
        }
    }
}
